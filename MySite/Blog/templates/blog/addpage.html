{% extends 'blog/base.html' %}

{% block content %}
<h1>{{ title }}</h1>

<form action="{% url 'add_page' %}" method="post" enctype="multipart/form-data">
    {% csrf_token %}

    <div class="form-error">{{ form.non_field_errors }}</div>

    {% for f in form %}
        {% if f.name == 'cat_post' %}
            <p>
                <label class="form-label" for="{{ f.id_for_label }}">{{ f.label }}: </label>
                {{ f }}
            </p>
            <div class="form-error">{{ f.errors }}</div>
        {% elif f.name == 'child_category' %}
            <p>
                <label class="form-label" for="{{ f.id_for_label }}">{{ f.label }}: </label>
                {{ f }}
            </p>
            <div class="form-error">{{ f.errors }}</div>
        {% else %}
            <p>
                <label class="form-label" for="{{ f.id_for_label }}">{{ f.label }}: </label>
                {{ f }}
            </p>
            <div class="form-error">{{ f.errors }}</div>
        {% endif %}
    {% endfor %}

    <button type="submit">Добавить</button>
</form>

<script>
    document.getElementById('id_cat_post').addEventListener('change', function() {
        var childCategoryField = document.getElementById('id_child_category');
        var parentCategoryId = this.value;

        // Make an AJAX call to get the child categories based on the selected parent category
        fetch(`/get_child_categories/${parentCategoryId}/`)
            .then(response => response.json())
            .then(data => {
                // Clear the existing options in the 'child_category' field
                childCategoryField.innerHTML = '';

                // Add the new options based on the received data
                data.forEach(category => {
                    var option = document.createElement('option');
                    option.value = category.id;
                    option.text = category.name;
                    childCategoryField.appendChild(option);
                });
            })
            .catch(error => {
                console.error('Error fetching child categories:', error);
            });
    });
</script>

{% endblock %}
